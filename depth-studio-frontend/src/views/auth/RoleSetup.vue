<template>
  <v-container fluid class="pa-0">
    <v-row no-gutters justify="center" align="center" style="min-height: 100vh;">
      <v-col cols="12" sm="10" md="8" lg="8" xl="7">
        <v-card 
          class="mx-auto role-setup-card" 
          :max-width="850"
          elevation="24"
          rounded="xl"
        >
          <div class="card-header">
            <v-img
              src="/logo-depth-studio.png"
              alt="Depth Studio"
              height="50"
              width="180"
              contain
              class="mx-auto mb-4"
            />
            <h1 class="text-h4 font-weight-bold text-center mb-2">
              Ø¥Ø¹Ø¯Ø§Ø¯ Ø¯ÙˆØ±Ùƒ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
            </h1>
            <p class="text-center text-medium-emphasis mb-6">
              Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ùƒ ÙˆØ§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            </p>
          </div>

          <v-card-text class="pa-8">
            <!-- Ù…Ø±Ø­Ù„Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆØ± -->
            <div v-if="currentStep === 'role-selection'">
              <h2 class="text-h5 mb-6 text-center">Ø§Ø®ØªØ± Ø¯ÙˆØ±Ùƒ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</h2>
              
              <v-row>
                <!-- Ù…ØµÙˆØ± -->
                <v-col cols="12" md="4">
                  <v-card 
                    class="role-card" 
                    :class="{ 'selected': selectedRole === 'photographer' }"
                    @click="selectRole('photographer')"
                    variant="outlined"
                    hover
                  >
                    <v-card-text class="text-center pa-6">
                      <v-icon size="64" color="primary" class="mb-4">
                        mdi-camera
                      </v-icon>
                      <h3 class="text-h6 mb-3">Ù…ØµÙˆØ±</h3>
                      <p class="text-body-2 mb-4">
                        Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„ØªØµÙˆÙŠØ± Ø§Ù„ÙÙˆØªÙˆØºØ±Ø§ÙÙŠ ÙˆØ¥Ù†ØªØ§Ø¬ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                      </p>
                      <v-chip color="success" variant="outlined" size="small">
                        ØªÙØ¹ÙŠÙ„ ÙÙˆØ±ÙŠ
                      </v-chip>
                    </v-card-text>
                  </v-card>
                </v-col>

                <!-- Ù…Ù†Ø³Ù‚ Ø¨Ø±Ø§Ù†Ø¯ -->
                <v-col cols="12" md="4">
                  <v-card 
                    class="role-card" 
                    :class="{ 'selected': selectedRole === 'brand_coordinator' }"
                    @click="selectRole('brand_coordinator')"
                    variant="outlined"
                    hover
                  >
                    <v-card-text class="text-center pa-6">
                      <v-icon size="64" color="warning" class="mb-4">
                        mdi-domain
                      </v-icon>
                      <h3 class="text-h6 mb-3">Ù…Ù†Ø³Ù‚ Ø¨Ø±Ø§Ù†Ø¯</h3>
                      <p class="text-body-2 mb-4">
                        Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø±Ø§Ù†Ø¯ Ù…Ø­Ø¯Ø¯ ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚ Ù…Ø¹ Ø§Ù„ÙØ±ÙŠÙ‚
                      </p>
                      <v-chip color="warning" variant="outlined" size="small">
                        ÙŠØ­ØªØ§Ø¬ Ù…ÙˆØ§ÙÙ‚Ø©
                      </v-chip>
                    </v-card-text>
                  </v-card>
                </v-col>

                <!-- Ù…Ù†Ø³Ù‚ ØªØ³ÙˆÙŠÙ‚ -->
                <v-col cols="12" md="4">
                  <v-card 
                    class="role-card" 
                    :class="{ 'selected': selectedRole === 'marketing_coordinator' }"
                    @click="selectRole('marketing_coordinator')"
                    variant="outlined"
                    hover
                  >
                    <v-card-text class="text-center pa-6">
                      <v-icon size="64" color="error" class="mb-4">
                        mdi-bullhorn
                      </v-icon>
                      <h3 class="text-h6 mb-3">Ù…Ù†Ø³Ù‚ ØªØ³ÙˆÙŠÙ‚</h3>
                      <p class="text-body-2 mb-4">
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ© ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰
                      </p>
                      <v-chip color="error" variant="outlined" size="small">
                        Ù…ÙˆØ§ÙÙ‚Ø© Ø®Ø§ØµØ©
                      </v-chip>
                    </v-card-text>
                  </v-card>
                </v-col>
              </v-row>

              <div class="text-center mt-8">
                <v-btn
                  color="primary"
                  size="large"
                  :disabled="!selectedRole"
                  @click="proceedToDetails"
                  rounded="lg"
                >
                  <v-icon start>mdi-arrow-left</v-icon>
                  Ù…ØªØ§Ø¨Ø¹Ø©
                </v-btn>
              </div>
            </div>

            <!-- Ù…Ø±Ø­Ù„Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØµÙˆØ± -->
            <div v-if="currentStep === 'photographer-details'">
              <v-form ref="photographerForm" v-model="isPhotographerFormValid">
                <h2 class="text-h5 mb-6 text-center">
                  <v-icon start>mdi-camera</v-icon>
                  Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù„Ù Ø§Ù„Ù…ØµÙˆØ±
                </h2>

                <!-- Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø¯ -->
                <v-card variant="outlined" class="mb-6">
                  <v-card-title>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø¯</v-card-title>
                  <v-card-text>
                    <v-radio-group v-model="photographerData.contractType" :rules="contractRules">
                      <v-radio value="freelancer">
                        <template #label>
                          <div>
                            <strong>ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø± (Ø¨Ø§Ù„Ù‚Ø·Ø¹Ø©)</strong>
                            <br>
                            <span class="text-caption text-medium-emphasis">
                              Ø£Ø¬Ø± Ù…ØªØºÙŠØ± Ø­Ø³Ø¨ Ù†ÙˆØ¹ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ù†Ø¬Ø²Ø©
                            </span>
                          </div>
                        </template>
                      </v-radio>
                      <v-radio value="salary">
                        <template #label>
                          <div>
                            <strong>Ø±Ø§ØªØ¨ Ø«Ø§Ø¨Øª</strong>
                            <br>
                            <span class="text-caption text-medium-emphasis">
                              Ø±Ø§ØªØ¨ Ø´Ù‡Ø±ÙŠ Ø«Ø§Ø¨Øª Ù…Ø¹ Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ø£Ø¯Ø§Ø¡
                            </span>
                          </div>
                        </template>
                      </v-radio>
                    </v-radio-group>
                  </v-card-text>
                </v-card>

                <!-- Ø§Ù„ØªØ®ØµØµØ§Øª -->
                <v-card variant="outlined" class="mb-6">
                  <v-card-title>Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø©</v-card-title>
                  <v-card-text>
                    <v-row>
                      <v-col v-for="specialization in availableSpecializations" :key="specialization.id" cols="6" md="4">
                        <v-checkbox
                          v-model="photographerData.specializations"
                          :value="specialization.id"
                          :label="specialization.name"
                          color="primary"
                        />
                      </v-col>
                    </v-row>
                  </v-card-text>
                </v-card>

                <!-- Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØªÙˆÙØ± -->
                <v-card variant="outlined" class="mb-6">
                  <v-card-title>Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØªÙˆÙØ± Ø§Ù„Ù…ÙØ¶Ù„Ø©</v-card-title>
                  <v-card-text>
                    <v-checkbox
                      v-model="photographerData.availability"
                      value="morning"
                      label="Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ© (8Øµ - 12Ø¸)"
                    />
                    <v-checkbox
                      v-model="photographerData.availability"
                      value="afternoon"
                      label="ÙØªØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¸Ù‡Ø± (12Ø¸ - 6Ù…)"
                    />
                    <v-checkbox
                      v-model="photographerData.availability"
                      value="evening"
                      label="Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ© (6Ù… - 10Ù…)"
                    />
                    <v-checkbox
                      v-model="photographerData.availability"
                      value="weekend"
                      label="Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹"
                    />
                  </v-card-text>
                </v-card>

                <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
                <v-textarea
                  v-model="photographerData.notes"
                  label="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø£Ùˆ Ø®Ø¨Ø±Ø§Øª Ø³Ø§Ø¨Ù‚Ø©"
                  variant="outlined"
                  rows="3"
                  class="mb-6"
                />

                <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ -->
                <v-alert
                  v-if="error"
                  type="error"
                  variant="outlined"
                  class="mb-4"
                  @click:close="clearError"
                  closable
                >
                  {{ error }}
                </v-alert>

                <div class="d-flex justify-space-between">
                  <v-btn variant="outlined" @click="goBack">
                    <v-icon start>mdi-arrow-right</v-icon>
                    Ø±Ø¬ÙˆØ¹
                  </v-btn>
                  <v-btn
                    color="primary"
                    :loading="isLoading"
                    :disabled="!isPhotographerFormValid || isLoading"
                    @click="handleSubmitPhotographer"
                  >
                    <v-icon start>mdi-check</v-icon>
                    Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                  </v-btn>
                </div>
              </v-form>
            </div>

            <!-- Ù…Ø±Ø­Ù„Ø© ØªÙØ§ØµÙŠÙ„ Ù…Ù†Ø³Ù‚ Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯ -->
            <div v-if="currentStep === 'brand-coordinator-details'">
              <v-form ref="brandCoordinatorForm" v-model="isBrandFormValid">
                <h2 class="text-h5 mb-6 text-center">
                  <v-icon start>mdi-domain</v-icon>
                  Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù†Ø³Ù‚ Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯
                </h2>

                <!-- Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯ -->
                <v-autocomplete
                  v-model="brandCoordinatorData.selectedBrand"
                  :items="availableBrands"
                  :rules="brandRules"
                  item-title="name"
                  item-value="id"
                  label="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨"
                  variant="outlined"
                  clearable
                  class="mb-6"
                >
                  <template #item="{ props, item }">
                    <v-list-item v-bind="props">
                      <template #prepend>
                        <v-avatar size="40" class="ms-3">
                          <v-img :src="item.raw.logo" :alt="item.raw.name" />
                        </v-avatar>
                      </template>
                      <v-list-item-title>{{ item.raw.name }}</v-list-item-title>
                      <v-list-item-subtitle>{{ item.raw.description }}</v-list-item-subtitle>
                    </v-list-item>
                  </template>
                </v-autocomplete>

                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯ Ø§Ù„Ù…Ø®ØªØ§Ø± -->
                <v-card v-if="selectedBrandInfo" variant="outlined" class="mb-6">
                  <v-card-title>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯ Ø§Ù„Ù…Ø®ØªØ§Ø±</v-card-title>
                  <v-card-text>
                    <div class="d-flex align-center mb-4">
                      <v-avatar size="60" class="ms-4">
                        <v-img :src="selectedBrandInfo.logo" :alt="selectedBrandInfo.name" />
                      </v-avatar>
                      <div>
                        <h3>{{ selectedBrandInfo.name }}</h3>
                        <p class="text-medium-emphasis">{{ selectedBrandInfo.description }}</p>
                      </div>
                    </div>
                    <v-chip-group>
                      <v-chip v-for="color in selectedBrandInfo.colors" :key="color" :color="color" size="small">
                        {{ color }}
                      </v-chip>
                    </v-chip-group>
                  </v-card-text>
                </v-card>

                <!-- Ø§Ù„Ø®Ø¨Ø±Ø© Ù…Ø¹ Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯ -->
                <v-textarea
                  v-model="brandCoordinatorData.experience"
                  :rules="experienceRules"
                  label="Ø§ÙƒØªØ¨ Ø¹Ù† Ø®Ø¨Ø±ØªÙƒ Ù…Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯ Ø£Ùˆ Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„ØªÙŠ ØªØ¬Ø¹Ù„Ùƒ Ù…Ù†Ø§Ø³Ø¨ Ù„ØªÙ†Ø³ÙŠÙ‚Ù‡"
                  variant="outlined"
                  rows="4"
                  class="mb-6"
                />

                <!-- Ø§Ù„Ø®Ø¨Ø±Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->
                <v-text-field
                  v-model="brandCoordinatorData.previousExperience"
                  label="Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¨Ø±Ø© ÙÙŠ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø£Ùˆ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª"
                  variant="outlined"
                  type="number"
                  min="0"
                  class="mb-6"
                />

                <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ -->
                <v-alert
                  v-if="error"
                  type="error"
                  variant="outlined"
                  class="mb-4"
                  @click:close="clearError"
                  closable
                >
                  {{ error }}
                </v-alert>

                <div class="d-flex justify-space-between">
                  <v-btn variant="outlined" @click="goBack">
                    <v-icon start>mdi-arrow-right</v-icon>
                    Ø±Ø¬ÙˆØ¹
                  </v-btn>
                  <v-btn
                    color="primary"
                    :loading="isLoading"
                    :disabled="!isBrandFormValid || isLoading"
                    @click="handleSubmitBrandCoordinator"
                  >
                    <v-icon start>mdi-send</v-icon>
                    Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
                  </v-btn>
                </div>
              </v-form>
            </div>

            <!-- Ù…Ø±Ø­Ù„Ø© ØªÙØ§ØµÙŠÙ„ Ù…Ù†Ø³Ù‚ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ -->
            <div v-if="currentStep === 'marketing-coordinator-details'">
              <v-form ref="marketingForm" v-model="isMarketingFormValid">
                <h2 class="text-h5 mb-6 text-center">
                  <v-icon start>mdi-bullhorn</v-icon>
                  Ø·Ù„Ø¨ Ø¯ÙˆØ± Ù…Ù†Ø³Ù‚ Ø§Ù„ØªØ³ÙˆÙŠÙ‚
                </h2>

                <v-alert type="warning" variant="outlined" class="mb-6">
                  <strong>ØªÙ†ÙˆÙŠÙ‡ Ù…Ù‡Ù…:</strong>
                  Ø¯ÙˆØ± Ù…Ù†Ø³Ù‚ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ ÙŠØªØ·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø© Ø®Ø§ØµØ© Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆÙ„Ù‡ ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØ§Ø³Ø¹Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù….
                </v-alert>

                <!-- Ø³Ø¨Ø¨ Ø§Ù„Ø·Ù„Ø¨ -->
                <v-textarea
                  v-model="marketingData.reason"
                  :rules="reasonRules"
                  label="Ù„Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªØµØ¨Ø­ Ù…Ù†Ø³Ù‚ ØªØ³ÙˆÙŠÙ‚ØŸ Ø§Ø´Ø±Ø­ Ø®Ø¨Ø±ØªÙƒ ÙˆÙ…Ø¤Ù‡Ù„Ø§ØªÙƒ"
                  variant="outlined"
                  rows="5"
                  class="mb-6"
                />

                <!-- Ø§Ù„Ø®Ø¨Ø±Ø© ÙÙŠ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ -->
                <v-text-field
                  v-model="marketingData.marketingExperience"
                  :rules="experienceMarketingRules"
                  label="Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¨Ø±Ø© ÙÙŠ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠ"
                  variant="outlined"
                  type="number"
                  min="0"
                  class="mb-6"
                />

                <!-- Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ© -->
                <v-card variant="outlined" class="mb-6">
                  <v-card-title>Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ©</v-card-title>
                  <v-card-text>
                    <v-checkbox
                      v-model="marketingData.marketingSpecializations"
                      value="social_media"
                      label="Ø¥Ø¯Ø§Ø±Ø© ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ"
                    />
                    <v-checkbox
                      v-model="marketingData.marketingSpecializations"
                      value="content_creation"
                      label="Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠ"
                    />
                    <v-checkbox
                      v-model="marketingData.marketingSpecializations"
                      value="campaign_management"
                      label="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©"
                    />
                    <v-checkbox
                      v-model="marketingData.marketingSpecializations"
                      value="analytics"
                      label="ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡"
                    />
                    <v-checkbox
                      v-model="marketingData.marketingSpecializations"
                      value="brand_management"
                      label="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©"
                    />
                  </v-card-text>
                </v-card>

                <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ -->
                <v-alert
                  v-if="error"
                  type="error"
                  variant="outlined"
                  class="mb-4"
                  @click:close="clearError"
                  closable
                >
                  {{ error }}
                </v-alert>

                <div class="d-flex justify-space-between">
                  <v-btn variant="outlined" @click="goBack">
                    <v-icon start>mdi-arrow-right</v-icon>
                    Ø±Ø¬ÙˆØ¹
                  </v-btn>
                  <v-btn
                    color="primary"
                    :loading="isLoading"
                    :disabled="!isMarketingFormValid || isLoading"
                    @click="handleSubmitMarketingCoordinator"
                  >
                    <v-icon start>mdi-send</v-icon>
                    Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
                  </v-btn>
                </div>
              </v-form>
            </div>
          </v-card-text>
        </v-card>
      </v-col>
    </v-row>
  </v-container>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { useAuth } from '@/composables/useAuth'
import { db } from '@/firebase/config'
import { collection, getDocs, doc, updateDoc, addDoc } from 'firebase/firestore'

// === Router ÙˆComposables ===
const router = useRouter()
const { userProfile, updateUserRole, error, clearError } = useAuth()

// === Reactive Data ===
const currentStep = ref('role-selection')
const selectedRole = ref('')
const isLoading = ref(false)

// Form validity refs
const isPhotographerFormValid = ref(false)
const isBrandFormValid = ref(false)
const isMarketingFormValid = ref(false)

// Form refs
const photographerForm = ref()
const brandCoordinatorForm = ref()
const marketingForm = ref()

// === Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµÙˆØ± ===
const photographerData = ref({
  contractType: '',
  specializations: [],
  availability: [],
  notes: ''
})

// === Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø³Ù‚ Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯ ===
const brandCoordinatorData = ref({
  selectedBrand: '' as string,
  experience: '',
  previousExperience: 0
})

// === Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø³Ù‚ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ ===
const marketingData = ref({
  reason: '',
  marketingExperience: 0,
  marketingSpecializations: []
})

// === Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯Ø§Øª ÙˆØ§Ù„ØªØ®ØµØµØ§Øª ===
const availableBrands = ref<any[]>([])
const availableSpecializations = ref([
  { id: 'product_photography', name: 'ØªØµÙˆÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª' },
  { id: 'portrait_photography', name: 'ØªØµÙˆÙŠØ± Ø§Ù„Ø£Ø´Ø®Ø§Øµ' },
  { id: 'video_production', name: 'Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ' },
  { id: 'graphic_design', name: 'Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø±Ø§ÙÙŠÙƒÙŠ' },
  { id: 'social_media_content', name: 'Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø³ÙˆØ´Ø§Ù„ Ù…ÙŠØ¯ÙŠØ§' },
  { id: 'commercial_photography', name: 'Ø§Ù„ØªØµÙˆÙŠØ± Ø§Ù„ØªØ¬Ø§Ø±ÙŠ' }
])

// === Computed Properties ===
const selectedBrandInfo = computed(() => {
  if (!brandCoordinatorData.value.selectedBrand) return null
  return availableBrands.value.find((brand: any) => brand.id === brandCoordinatorData.value.selectedBrand)
})

// === Validation Rules ===
const contractRules = [
  (v: string) => !!v || 'ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø¯'
]

const brandRules = [
  (v: string) => !!v || 'ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯'
]

const experienceRules = [
  (v: string) => !!v || 'ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø®Ø¨Ø±ØªÙƒ',
  (v: string) => (v && v.length >= 50) || 'ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© 50 Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'
]

const reasonRules = [
  (v: string) => !!v || 'ÙŠØ¬Ø¨ Ø´Ø±Ø­ Ø³Ø¨Ø¨ Ø§Ù„Ø·Ù„Ø¨',
  (v: string) => (v && v.length >= 100) || 'ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© 100 Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'
]

const experienceMarketingRules = [
  (v: number) => v >= 1 || 'ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù„Ø¯ÙŠÙƒ Ø®Ø¨Ø±Ø© Ø³Ù†Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'
]

// === Methods ===
const selectRole = (role: string) => {
  selectedRole.value = role
}

const proceedToDetails = () => {
  switch (selectedRole.value) {
    case 'photographer':
      currentStep.value = 'photographer-details'
      break
    case 'brand_coordinator':
      currentStep.value = 'brand-coordinator-details'
      break
    case 'marketing_coordinator':
      currentStep.value = 'marketing-coordinator-details'
      break
  }
}

const goBack = () => {
  currentStep.value = 'role-selection'
  selectedRole.value = ''
}

const goToLogin = () => {
  router.push('/auth/login')
}

// === ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯Ø§Øª ===
const loadBrands = async () => {
  try {
    const brandsSnapshot = await getDocs(collection(db, 'brands'))
    availableBrands.value = brandsSnapshot.docs.map(doc => ({
      id: doc.id,
      ...doc.data()
    }))
  } catch (error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯Ø§Øª:', error)
  }
}

const handleSubmitPhotographer = async () => {
  try {
    isLoading.value = true
    clearError()
    
    console.log('ğŸ“¸ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµÙˆØ±...')
    
    if (!userProfile.value?.uid) {
      throw new Error('Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ØªÙˆÙØ±')
    }
    
    await updateUserRole(userProfile.value.uid, 'photographer', {
      photographer_contract_type: photographerData.value.contractType,
      photographer_specializations: photographerData.value.specializations,
      photographer_availability: photographerData.value.availability,
      photographer_notes: photographerData.value.notes
    })
    
    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµÙˆØ± Ø¨Ù†Ø¬Ø§Ø­')
    
    // ğŸ”„ ØªØ­Ø¯ÙŠØ«: ØªÙˆØ¬ÙŠÙ‡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ù„ØµÙØ­Ø© Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
    router.push('/auth/pending-approval')
    
  } catch (err: any) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµÙˆØ±:', err)
    // Ø§Ù„Ø®Ø·Ø£ Ø³ÙŠØ¸Ù‡Ø± Ù…Ù† Ø®Ù„Ø§Ù„ error ref
  } finally {
    isLoading.value = false
  }
}

const handleSubmitBrandCoordinator = async () => {
  try {
    isLoading.value = true
    clearError()
    
    console.log('ğŸ¢ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø³Ù‚ Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯...')
    
    if (!userProfile.value?.uid) {
      throw new Error('Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ØªÙˆÙØ±')
    }
    
    await updateUserRole(userProfile.value.uid, 'brand_coordinator', {
      requested_brand_id: brandCoordinatorData.value.selectedBrand,
      brand_experience: brandCoordinatorData.value.experience,
      previous_experience_years: brandCoordinatorData.value.previousExperience
    })
    
    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø³Ù‚ Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯ Ø¨Ù†Ø¬Ø§Ø­')
    router.push('/auth/pending-approval')
    
  } catch (err: any) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø³Ù‚ Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯:', err)
  } finally {
    isLoading.value = false
  }
}

const handleSubmitMarketingCoordinator = async () => {
  try {
    isLoading.value = true
    clearError()
    
    console.log('ğŸ“ˆ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø³Ù‚ Ø§Ù„ØªØ³ÙˆÙŠÙ‚...')
    
    if (!userProfile.value?.uid) {
      throw new Error('Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ØªÙˆÙØ±')
    }
    
    await updateUserRole(userProfile.value.uid, 'marketing_coordinator', {
      marketing_reason: marketingData.value.reason,
      marketing_experience_years: marketingData.value.marketingExperience,
      marketing_specializations: marketingData.value.marketingSpecializations
    })
    
    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø³Ù‚ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­')
    router.push('/auth/pending-approval')
    
  } catch (err: any) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø³Ù‚ Ø§Ù„ØªØ³ÙˆÙŠÙ‚:', err)
  } finally {
    isLoading.value = false
  }
}

// === Lifecycle ===
onMounted(() => {
  loadBrands()
})
</script>

<style scoped lang="scss">
@import '@/styles/design-system/index';

.role-setup-page {
  min-height: 100vh;
  background: linear-gradient(135deg, var(--color-info-400) 0%, var(--color-info-600) 100%);
  
  .role-setup-container {
    padding: var(--spacing-6);
  }
  
  .role-setup-card {
    max-width: 500px;
    width: 100%;
    margin: 0 auto;
    border-radius: var(--border-radius-lg);
    box-shadow: var(--elevation-high);
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    
    .v-card__text {
      padding: var(--spacing-8);
    }
  }
  
  .role-setup-title {
    margin-bottom: var(--spacing-6);
    text-align: center;
    color: var(--color-text-primary);
  }
  
  .role-option {
    transition: all var(--transition-normal) var(--easing-ease-out);
    border: 2px solid var(--color-border-light);
    border-radius: var(--border-radius-md);
    padding: var(--spacing-4);
    margin-bottom: var(--spacing-3);
    cursor: pointer;
    
    &:hover {
      border-color: var(--color-primary-500);
      transform: translateY(-2px);
      box-shadow: var(--elevation-medium);
    }
    
    &.selected {
      border-color: var(--color-primary-500);
      background-color: var(--color-primary-50);
    }
  }
  
  .role-title {
    font-weight: 600;
    color: var(--color-text-primary);
    margin-bottom: var(--spacing-1);
  }
  
  .role-description {
    color: var(--color-text-secondary);
    font-size: 0.875rem;
  }
  
  .continue-button {
    margin-top: var(--spacing-6);
    height: 48px;
    font-weight: 600;
    text-transform: none;
  }
  
  .back-link {
    margin-top: var(--spacing-4);
    text-align: center;
    color: var(--color-text-secondary);
  }
  
  // Specific role styling
  .photographer-option {
    .role-icon {
      color: var(--color-primary-500);
    }
  }
  
  .coordinator-option {
    .role-icon {
      color: var(--color-info-500);
    }
  }
  
  .client-option {
    .role-icon {
      color: var(--color-success-500);
    }
  }
}

// Responsive design
@media (max-width: 600px) {
  .role-setup-page {
    .role-setup-container {
      padding: var(--spacing-4);
    }
    
    .role-setup-card {
      .v-card__text {
        padding: var(--spacing-6);
      }
    }
    
    .role-option {
      padding: var(--spacing-3);
    }
  }
}
</style> 
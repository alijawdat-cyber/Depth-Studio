/**
 * ==============================================
 * DEPTH STUDIO - أنماط القائمة الجانبية
 * Sidebar Layout Styles
 * ==============================================
 */

@use "sass:map";
@use '../foundation/_variables' as vars;
@use '../foundation/_colors' as colors;
@use '../foundation/_spacing' as spacing;
@use '../foundation/_typography' as typo;
@use '../foundation/_breakpoints' as breakpoints;
@use '../utilities/_mixins' as mixins;

// ===============================
// 📐 SIDEBAR VARIABLES
// ===============================

$sidebar-widths: (
  "compact": 60px,
  "medium": 240px,
  "wide": 280px,
  "extra-wide": 320px
) !default;

$sidebar-animation: (
  "duration": map.get(vars.$transition-duration, "base"),
  "timing": map.get(vars.$transition-timing, "ease-out")
) !default;

// ===============================
// 🎨 SIDEBAR CONTAINER
// ===============================

.sidebar {
  // الأساسيات
  position: fixed;
  top: 0;
  bottom: 0;
  z-index: map.get(vars.$z-index, "docked");
  
  // العرض والتخطيط
  width: var(--sidebar-width, #{map.get($sidebar-widths, "wide")});
  background: var(--color-surface);
  border-right: 1px solid var(--color-divider);
  
  // التأثيرات البصرية
  @include mixins.elevation(2);
  @include mixins.custom-scrollbar;
  
  // الحركات
  @include mixins.transition(all, "base");
  
  // الاتجاه RTL
  [dir="rtl"] & {
    left: 0;
    border-right: none;
    border-left: 1px solid var(--color-divider);
  }
  
  [dir="ltr"] & {
    left: 0;
  }
  
  // ===============================
  // 🎛️ SIDEBAR VARIANTS
  // ===============================
  
  // القائمة المدمجة
  &--compact {
    --sidebar-width: #{map.get($sidebar-widths, "compact")};
    
    .sidebar__menu-text,
    .sidebar__menu-arrow {
      opacity: 0;
      transform: translateX(-10px);
    }
    
    .sidebar__logo-text {
      display: none;
    }
    
    .sidebar__menu-item {
      justify-content: center;
      
      &:hover {
        .sidebar__menu-text {
          position: absolute;
          left: 100%;
          top: 50%;
          transform: translateY(-50%);
          background: var(--color-surface);
          border: 1px solid var(--color-divider);
          padding: var(--spacing-xs) var(--spacing-sm);
          @include mixins.border-radius("sm");
          @include mixins.elevation(3);
          opacity: 1;
          white-space: nowrap;
          z-index: 1000;
        }
      }
    }
  }
  
  // القائمة المخفية
  &--collapsed {
    transform: translateX(-100%);
    
    [dir="rtl"] & {
      transform: translateX(100%);
    }
  }
  
  // القائمة العائمة (للموبايل)
  &--floating {
    @include breakpoints.mobile-layout {
      position: fixed;
      top: var(--topbar-height, 64px);
      background: rgba(var(--color-surface-rgb), 0.95);
      @include mixins.backdrop-blur(20px);
      @include mixins.elevation(4);
      border-radius: 0 var(--border-radius-lg) var(--border-radius-lg) 0;
      
      [dir="rtl"] & {
        border-radius: var(--border-radius-lg) 0 0 var(--border-radius-lg);
      }
    }
  }
  
  // ===============================
  // 🎨 SIDEBAR HEADER
  // ===============================
  
  &__header {
    padding: var(--spacing-lg) var(--spacing-md);
    border-bottom: 1px solid var(--color-divider);
    @include mixins.flex-center(column, var(--spacing-sm));
    
    .sidebar--compact & {
      padding: var(--spacing-md) var(--spacing-xs);
    }
  }
  
  &__logo {
    @include mixins.flex-center(row, var(--spacing-sm));
    text-decoration: none;
    color: var(--color-text-primary);
    @include mixins.transition(color, "fast");
    
    &:hover {
      color: var(--color-primary);
    }
    
    &-icon {
      @include mixins.size(32px);
      color: var(--color-primary);
    }
    
    &-text {
      @include mixins.text-style("title-medium");
      font-weight: var(--font-weight-bold);
      color: var(--color-text-primary);
      @include mixins.transition(opacity, "base");
    }
  }
  
  &__brand-info {
    text-align: center;
    @include mixins.transition(opacity, "base");
    
    .sidebar--compact & {
      display: none;
    }
    
    &-name {
      @include mixins.text-style("body-small");
      color: var(--color-text-secondary);
      margin-top: var(--spacing-xs);
    }
    
    &-role {
      @include mixins.text-style("caption");
      color: var(--color-text-hint);
      background: var(--color-primary-container);
      padding: var(--spacing-xs) var(--spacing-sm);
      @include mixins.border-radius("full");
      margin-top: var(--spacing-xs);
      display: inline-block;
    }
  }
  
  // ===============================
  // 📋 SIDEBAR MENU
  // ===============================
  
  &__menu {
    padding: var(--spacing-md) 0;
    flex: 1;
    overflow-y: auto;
    @include mixins.custom-scrollbar;
  }
  
  &__menu-section {
    & + & {
      margin-top: var(--spacing-lg);
      padding-top: var(--spacing-lg);
      border-top: 1px solid var(--color-divider);
    }
    
    &-title {
      @include mixins.text-style("label-small");
      color: var(--color-text-hint);
      padding: 0 var(--spacing-md) var(--spacing-sm);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      @include mixins.transition(opacity, "base");
      
      .sidebar--compact & {
        display: none;
      }
    }
  }
  
  &__menu-item {
    position: relative;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-md);
    margin: var(--spacing-xs) var(--spacing-sm);
    text-decoration: none;
    color: var(--color-text-secondary);
    @include mixins.border-radius("md");
    @include mixins.transition(all, "fast");
    cursor: pointer;
    
    // التفاعل
    &:hover {
      background: var(--color-primary-container);
      color: var(--color-on-primary-container);
      transform: translateX(2px);
      
      [dir="rtl"] & {
        transform: translateX(-2px);
      }
    }
    
    // الحالة النشطة
    &--active {
      background: var(--color-primary);
      color: var(--color-on-primary);
      box-shadow: 0 2px 8px rgba(var(--color-primary-rgb), 0.3);
      
      &::before {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 3px;
        height: 20px;
        background: var(--color-on-primary);
        @include mixins.border-radius("full");
        
        [dir="rtl"] & {
          left: auto;
          right: 0;
        }
      }
    }
    
    // العناصر الفرعية
    &--has-children {
      .sidebar__menu-arrow {
        margin-left: auto;
        @include mixins.transition(transform, "fast");
        
        [dir="rtl"] & {
          margin-left: 0;
          margin-right: auto;
        }
      }
      
      &.sidebar__menu-item--expanded {
        .sidebar__menu-arrow {
          transform: rotate(90deg);
        }
      }
    }
    
    // التعطيل
    &--disabled {
      opacity: 0.5;
      cursor: not-allowed;
      
      &:hover {
        background: transparent;
        transform: none;
      }
    }
  }
  
  &__menu-icon {
    @include mixins.size(20px);
    flex-shrink: 0;
    @include mixins.transition(transform, "fast");
    
    .sidebar__menu-item:hover & {
      transform: scale(1.1);
    }
  }
  
  &__menu-text {
    @include mixins.text-style("body");
    font-weight: var(--font-weight-medium);
    @include mixins.transition(all, "base");
    flex: 1;
  }
  
  &__menu-badge {
    @include mixins.text-style("caption");
    background: var(--color-error);
    color: var(--color-on-error);
    padding: var(--spacing-xs) var(--spacing-sm);
    @include mixins.border-radius("full");
    min-width: 20px;
    text-align: center;
    font-weight: var(--font-weight-bold);
  }
  
  &__menu-arrow {
    @include mixins.size(16px);
    @include mixins.transition(all, "base");
  }
  
  // ===============================
  // 📁 SUBMENU SYSTEM
  // ===============================
  
  &__submenu {
    max-height: 0;
    overflow: hidden;
    @include mixins.transition(max-height, "base");
    
    &--expanded {
      max-height: 500px;
    }
    
    .sidebar__menu-item {
      margin-left: var(--spacing-lg);
      margin-right: var(--spacing-sm);
      padding-left: var(--spacing-lg);
      
      [dir="rtl"] & {
        margin-left: var(--spacing-sm);
        margin-right: var(--spacing-lg);
        padding-left: var(--spacing-sm);
        padding-right: var(--spacing-lg);
      }
      
      &::before {
        content: '';
        position: absolute;
        left: var(--spacing-md);
        top: 50%;
        transform: translateY(-50%);
        width: 2px;
        height: 16px;
        background: var(--color-outline);
        
        [dir="rtl"] & {
          left: auto;
          right: var(--spacing-md);
        }
      }
    }
  }
  
  // ===============================
  // 🔧 SIDEBAR FOOTER
  // ===============================
  
  &__footer {
    padding: var(--spacing-md);
    border-top: 1px solid var(--color-divider);
    margin-top: auto;
  }
  
  &__user-info {
    @include mixins.flex-start(row, var(--spacing-sm));
    padding: var(--spacing-sm);
    @include mixins.border-radius("md");
    @include mixins.transition(background, "fast");
    cursor: pointer;
    
    &:hover {
      background: var(--color-surface-variant);
    }
    
    .sidebar--compact & {
      justify-content: center;
      
      .sidebar__user-details {
        display: none;
      }
    }
    
    &-avatar {
      @include mixins.size(36px);
      @include mixins.border-radius("full");
      overflow: hidden;
      background: var(--color-primary);
      @include mixins.flex-center;
      color: var(--color-on-primary);
      font-weight: var(--font-weight-bold);
    }
    
    &-details {
      flex: 1;
      min-width: 0;
      
      .user-name {
        @include mixins.text-style("body-small");
        color: var(--color-text-primary);
        font-weight: var(--font-weight-medium);
        @include mixins.text-ellipsis;
      }
      
      .user-role {
        @include mixins.text-style("caption");
        color: var(--color-text-hint);
        @include mixins.text-ellipsis;
      }
    }
  }
  
  &__toggle-btn {
    position: absolute;
    top: 50%;
    right: -12px;
    transform: translateY(-50%);
    @include mixins.size(24px);
    background: var(--color-surface);
    border: 1px solid var(--color-divider);
    @include mixins.border-radius("full");
    @include mixins.flex-center;
    cursor: pointer;
    @include mixins.transition(all, "fast");
    z-index: 1;
    
    [dir="rtl"] & {
      right: auto;
      left: -12px;
    }
    
    &:hover {
      background: var(--color-primary);
      color: var(--color-on-primary);
      @include mixins.elevation(2);
    }
    
    .sidebar--compact & {
      transform: translateY(-50%) rotate(180deg);
    }
  }
}

// ===============================
// 📱 RESPONSIVE BEHAVIOR
// ===============================

@include breakpoints.mobile-layout {
  .sidebar {
    width: 100%;
    max-width: 280px;
    transform: translateX(-100%);
    
    [dir="rtl"] & {
      transform: translateX(100%);
    }
    
    &--open {
      transform: translateX(0);
    }
    
    &__toggle-btn {
      display: none;
    }
  }
}

@include breakpoints.tablet-layout {
  .sidebar {
    --sidebar-width: #{map.get($sidebar-widths, "medium")};
  }
}

@include breakpoints.desktop-layout {
  .sidebar {
    position: static;
    height: 100vh;
    flex-shrink: 0;
  }
}

// ===============================
// 🎨 THEME VARIATIONS
// ===============================

// الوضع المظلم
@media (prefers-color-scheme: dark) {
  .sidebar {
    &__menu-item {
      &:hover {
        background: rgba(var(--color-primary-rgb), 0.1);
      }
      
      &--active {
        background: var(--color-primary);
        box-shadow: 0 2px 8px rgba(var(--color-primary-rgb), 0.2);
      }
    }
  }
}

// تخصيص للطباعة
@media print {
  .sidebar {
    display: none !important;
  }
}

// تحسين الأداء
.sidebar {
  will-change: transform;
  
  &__menu-item {
    will-change: background-color, transform;
  }
}

// دعم تقليل الحركة
@media (prefers-reduced-motion: reduce) {
  .sidebar,
  .sidebar__menu-item,
  .sidebar__submenu,
  .sidebar__menu-arrow {
    transition: none !important;
  }
} 
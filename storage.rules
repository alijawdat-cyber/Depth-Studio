rules_version = '2';

// ğŸ—„ï¸ Ù‚ÙˆØ§Ù†ÙŠÙ† Ø£Ù…Ø§Ù† Firebase Storage - Depth Studio
// ğŸ“… Ù…Ø­Ø¯Ø«: ÙŠÙˆÙ†ÙŠÙˆ 2025
// ğŸ‘¤ Ø§Ù„Ù…Ø·ÙˆØ±: Ø¹Ù„ÙŠ Ø¬ÙˆØ¯Øª
// ğŸ¯ Ø­Ù…Ø§ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„ØµÙˆØ±

service firebase.storage {
  match /b/{bucket}/o {
    
    // ==========================================
    // ğŸ› ï¸ HELPER FUNCTIONS (Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©)
    // ==========================================
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø³Ù…ÙˆØ­
    function isAllowedImageType() {
      return resource.contentType.matches('image/.*') && 
             resource.contentType in ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (Ø£Ù‚Ù„ Ù…Ù† 10MB)
    function isValidSize() {
      return resource.size < 10 * 1024 * 1024;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ù…Ù„Ù
    function isOwner(userId) {
      return request.auth.uid == userId;
    }
    
    // ==========================================
    // ğŸ“¸ Ù…Ø¬Ù„Ø¯ ØµÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Profile Pictures)
    // ==========================================
    match /users/{userId}/profile/{fileName} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
      allow read: if isAuthenticated();
      
      // Ø§Ù„ÙƒØªØ§Ø¨Ø©: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡ ÙÙ‚Ø·
      allow write: if isAuthenticated() && 
                      isOwner(userId) && 
                      isAllowedImageType() && 
                      isValidSize();
    }
    
    // ==========================================
    // ğŸ¨ Ù…Ø¬Ù„Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ù…Ù„Ø§Øª (Content)
    // ==========================================
    match /content/{contentId}/{fileName} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ (Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©)
      allow read: if isAuthenticated();
      
      // Ø§Ù„ÙƒØªØ§Ø¨Ø©: Ø§Ù„Ù…ØµÙˆØ±ÙŠÙ† ÙˆØ§Ù„Ù…Ø¯Ø±Ø§Ø¡ ÙÙ‚Ø·
      allow write: if isAuthenticated() && 
                      isAllowedImageType() && 
                      isValidSize();
    }
    
    // ==========================================
    // ğŸ¢ Ù…Ø¬Ù„Ø¯ Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯Ø§Øª (Brand Logos)  
    // ==========================================
    match /brands/{brandId}/logo/{fileName} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
      allow read: if isAuthenticated();
      
      // Ø§Ù„ÙƒØªØ§Ø¨Ø©: Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡ ÙÙ‚Ø·
      allow write: if isAuthenticated() && 
                      isAllowedImageType() && 
                      isValidSize();
    }
    
    // ==========================================
    // ğŸ“± Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© (General Uploads)
    // ==========================================
    match /uploads/{userId}/{fileName} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ø§Ù„Ùƒ Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow read: if isAuthenticated() && isOwner(userId);
      
      // Ø§Ù„ÙƒØªØ§Ø¨Ø©: Ø§Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø·
      allow write: if isAuthenticated() && 
                      isOwner(userId) && 
                      isAllowedImageType() && 
                      isValidSize();
    }
    
    // ==========================================
    // ğŸ¥ Ù…Ø¬Ù„Ø¯ Ù…Ø¹Ø¯Ø§Øª Ø§Ù„ØªØµÙˆÙŠØ± (Equipment Images)
    // ==========================================
    match /equipment/{equipmentId}/{fileName} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†
      allow read: if isAuthenticated();
      
      // Ø§Ù„ÙƒØªØ§Ø¨Ø©: Ø§Ù„Ù…ØµÙˆØ±ÙŠÙ† ÙˆØ§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow write: if isAuthenticated() && 
                      isAllowedImageType() && 
                      isValidSize();
    }
    
    // ==========================================
    // ğŸ“‹ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª (Documents) - PDF ÙˆØºÙŠØ±Ù‡Ø§
    // ==========================================
    match /documents/{userId}/{fileName} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø·
      allow read: if isAuthenticated() && isOwner(userId);
      
      // Ø§Ù„ÙƒØªØ§Ø¨Ø©: Ø§Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø· Ù…Ø¹ Ù‚ÙŠÙˆØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
      allow write: if isAuthenticated() && 
                      isOwner(userId) && 
                      (resource.contentType in ['application/pdf', 'text/plain', 'application/msword']) &&
                      resource.size < 5 * 1024 * 1024; // 5MB Ù„Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª
    }
    
    // ==========================================
    // ğŸ—‘ï¸ Ù…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø£ÙŠ Ù…Ø³Ø§Ø± ØºÙŠØ± Ù…Ø­Ø¯Ø¯
    // ==========================================
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}

// ==========================================
// ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†:
// ==========================================
// âœ… Ø¯Ø¹Ù… Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØµÙˆØ±: JPEG, PNG, WebP, GIF
// âœ… Ø­Ø¯ Ø£Ù‚ØµÙ‰ 10MB Ù„Ù„ØµÙˆØ±
// âœ… Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5MB Ù„Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª  
// âœ… Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ ØºÙŠØ± Ø§Ù„Ù…ØµØ±Ø­
// âœ… ÙØµÙ„ ÙˆØ§Ø¶Ø­ Ø¨ÙŠÙ† Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
// âœ… ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…ØªØ¯Ø±Ø¬Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ 
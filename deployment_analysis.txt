ğŸ”¥ DEPTH STUDIO DEPLOYMENT FILES EXTRACTION REPORT - COMPREHENSIVE
===============================================================
Generated on: $(date)
Project Directory: $(pwd)
Status: PATCH V7 Applied - middleware-manifest.json fix
Analysis Type: Complete Firebase App Hosting Deployment Files

ğŸš€ CORE DEPLOYMENT CONFIGURATION:
=================================

ğŸ“ FILE: apphosting.yaml (ğŸ”¥ UPDATED WITH PATCH V7)
============================= # Firebase App Hosting Configuration
# Depth Studio Frontend Deployment Settings
#
# ğŸ”¥ FINAL & DEFINITIVE FIX v5.0 ğŸ”¥
# SOLUTION: Firebase ignores custom buildCommand when it detects Next.js
# We will TRICK Firebase by hiding Next.js detection and force custom build

# Build settings
runConfig:
  runtime: nodejs18
  minInstances: 0
  maxInstances: 100
  concurrency: 1000
  
env:
  # Firebase Configuration - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
  - variable: NEXT_PUBLIC_FIREBASE_API_KEY
    value: AIzaSyDHg1-mxejIMPycZJQeE0sZJmWxsimaMFI
  - variable: NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
    value: depth-studio.firebaseapp.com
  - variable: NEXT_PUBLIC_FIREBASE_DATABASE_URL
    value: https://depth-studio-default-rtdb.firebaseio.com
  - variable: NEXT_PUBLIC_FIREBASE_PROJECT_ID
    value: depth-studio
  - variable: NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
    value: depth-studio.firebasestorage.app
  - variable: NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
    value: "584154257700"
  - variable: NEXT_PUBLIC_FIREBASE_APP_ID
    value: 1:584154257700:web:b570a34dc3854662c3fbb1
  - variable: NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID
    value: G-RY2WLQCK1T
  
  # Google OAuth
  - variable: NEXT_PUBLIC_GOOGLE_CLIENT_ID
    value: 584154257700-d6vp6d876am0c0loapthj64o4riii616.apps.googleusercontent.com
    
  # FCM Notification
  - variable: NEXT_PUBLIC_FCM_VAPID_KEY
    value: BOvPwykYYlnNPddjFxvBVb5sv5VEYGgzMNkbuupSYRVUubcZVHy_--Rm479cbqyTo5vkYxgv9R3rENhknUfJWDg
  
  # Application Configuration - Ù„Ù„Ø¥Ù†ØªØ§Ø¬
  - variable: NEXT_PUBLIC_API_URL
    value: https://us-central1-depth-studio.cloudfunctions.net/api
  - variable: NEXT_PUBLIC_BACKEND_URL
    value: https://us-central1-depth-studio.cloudfunctions.net/api
  - variable: NEXT_PUBLIC_FUNCTIONS_URL
    value: https://us-central1-depth-studio.cloudfunctions.net/api
  - variable: NEXT_PUBLIC_APP_ENV
    value: production
  - variable: NEXT_PUBLIC_ENABLE_LOGGING
    value: "true"
  - variable: NEXT_PUBLIC_FIRESTORE_DATABASE_ID
    value: depth-production
  - variable: NEXT_PUBLIC_USE_EMULATOR
    value: "false"
  - variable: NEXT_PUBLIC_ENABLE_APP_CHECK
    value: "true"
  - variable: NEXT_PUBLIC_APP_CHECK_DEBUG_TOKEN
    value: "false"

buildConfig:
  # ğŸ¯ ULTIMATE TRICK: Hide Next.js from Firebase detection, then force our build
  buildCommand: |
    set -e
    echo "ğŸ”¥ STEALTH BUILD v5.0 - Tricking Firebase and building manually..."
    
    # STEALTH STEP: Temporarily hide Next.js detection by renaming next.config.js
    if [ -f "frontend/next.config.js" ]; then
      mv frontend/next.config.js frontend/next.config.js.hidden
    fi
    
    # Step 1: Install all dependencies normally
    npm install
    
    # STEALTH STEP: Restore next.config.js for the build
    if [ -f "frontend/next.config.js.hidden" ]; then
      mv frontend/next.config.js.hidden frontend/next.config.js
    fi
    
    # Step 2: Build frontend manually (creates frontend/.next/standalone/frontend/.next/server/)
    echo "Building frontend application..."
    cd frontend && npm run build && cd ..
    
    # Step 3: Create the Firebase-expected structure
    echo "Creating Firebase-compatible structure..."
    mkdir -p .next/standalone/.next/server
    
    # Step 4: Copy everything from frontend standalone to root
    cp -r frontend/.next/standalone/* .next/standalone/
    
    # Step 5: Fix the nested server path that Firebase buildpack expects
    if [ -d ".next/standalone/frontend/.next/server" ]; then
      echo "Fixing nested server paths..."
      cp -r .next/standalone/frontend/.next/server/* .next/standalone/.next/server/
    fi
    
    # Step 5-B: ğŸ”¥ PATCH V7 - Move middleware-manifest.json to where Firebase expects it
    if [ -f ".next/standalone/.next/middleware-manifest.json" ] && \
       [ ! -f ".next/standalone/.next/server/middleware-manifest.json" ]; then
      echo "Moving middleware-manifest.json into server/ directory..."
      mv .next/standalone/.next/middleware-manifest.json \
         .next/standalone/.next/server/middleware-manifest.json
    fi
    
    # Create empty manifest if doesn't exist at all (fallback safety)
    if [ ! -f ".next/standalone/.next/server/middleware-manifest.json" ]; then
      echo "Creating fallback middleware-manifest.json..."
      echo "{}" > .next/standalone/.next/server/middleware-manifest.json
    fi
    
    # Step 6: Move the main server.js to the root where Firebase expects it
    if [ -f ".next/standalone/frontend/server.js" ]; then
      echo "Moving main server.js to root..."
      cp .next/standalone/frontend/server.js .next/standalone/server.js
    fi
    
    # Step 7: Clean up the nested frontend directory
    rm -rf .next/standalone/frontend
    
    # Step 8: Final verification
    echo "âœ… Verifying Firebase expects these files..."
    ls -la .next/standalone/.next/server/middleware-manifest.json
    echo "âœ… server.js location:"
    ls -la .next/standalone/server.js
    echo "âœ… package.json location:"
    ls -la .next/standalone/package.json
    
    echo "ğŸ¯ SUCCESS: Complete Firebase-compatible structure created!"
  
  # Firebase will find everything exactly where the buildpack expects
  outputDirectory: .next/standalone 
END OF FILE: apphosting.yaml
=============================

ğŸ“ FILE: package.json (ROOT MONOREPO)
=======================
{
  "name": "depth-studio-unified",
  "version": "1.0.0",
  "description": "Depth Studio - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ",
  "main": "index.js",
  "scripts": {
    "dev": "concurrently \"npm run --workspace=frontend dev\" \"npm run --workspace=backend start\"",
    "dev:frontend": "npm run --workspace=frontend dev",
    "dev:backend": "npm run --workspace=backend start",
    "build": "npm run --workspace=types build && npm run --workspace=backend build && npm run --workspace=frontend build",
    "build:frontend": "npm run --workspace=frontend build",
    "build:backend": "npm run --workspace=backend build",
    "build:types": "npm run --workspace=types build",
    "install:all": "npm ci",
    "firebase:serve": "firebase serve",
    "firebase:deploy": "firebase deploy",
    "test": "npm run --workspace=frontend test && npm run --workspace=backend test",
    "test:frontend": "npm run --workspace=frontend test",
    "test:backend": "npm run --workspace=backend test",
    "lint": "npm run --workspace=frontend lint && npm run --workspace=backend lint",
    "lint:frontend": "npm run --workspace=frontend lint",
    "lint:backend": "npm run --workspace=backend lint"
  },
  "workspaces": [
    "frontend",
    "backend",
    "types"
  ],
  "overrides": {
    "picomatch": "^4.0.2"
  },
  "keywords": [
    "next.js",
    "react",
    "firebase",
    "ai",
    "content-management",
    "pwa",
    "typescript"
  ],
  "author": "Ali Jawdat",
  "license": "MIT",
  "devDependencies": {
    "@types/fluent-ffmpeg": "^2.1.27",
    "@types/jest": "^29.5.14",
    "concurrently": "^8.2.0",
    "firebase-tools": "^12.0.0",
    "ts-jest": "^29.3.4"
  },
  "engines": {
    "node": ">=18.0.0",
    "npm": ">=9.0.0"
  },
  "dependencies": {
    "ffprobe-static": "^3.1.0",
    "fluent-ffmpeg": "^2.1.3",
    "sharp": "^0.34.2"
  }
}

END OF FILE: package.json
======================

ğŸ¨ FRONTEND CONFIGURATION:
=========================

ğŸ“ FILE: frontend/package.json
===============================
{
  "name": "frontend",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "preview": "next build && next start",
    "lint": "rm -f .eslintrc.json && eslint src/",
    "lint:fix": "next lint --fix",
    "format": "prettier --write .",
    "format:check": "prettier --check .",
    "type-check": "tsc --noEmit",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage",
    "clean": "rm -rf .next out dist",
    "build:production": "NODE_ENV=production next build",
    "export": "next export"
  },
  "dependencies": {
    "@emotion/react": "^11.14.0",
    "@emotion/styled": "^11.14.0",
    "@mui/icons-material": "^7.1.1",
    "@mui/material": "^7.1.1",
    "@tanstack/react-query": "^5.80.5",
    "@tanstack/react-query-devtools": "^5.80.5",
    "axios": "^1.9.0",
    "clsx": "^2.0.0",
    "firebase": "^11.9.0",
    "next": "^14.2.29",
    "next-themes": "^0.4.6",
    "react": "^18",
    "react-dom": "^18",
    "react-icons": "^4.12.0",
    "tailwind-merge": "^3.3.0",
    "zustand": "^5.0.5"
  },
  "devDependencies": {
    "@testing-library/dom": "^10.4.0",
    "@testing-library/jest-dom": "^6.6.3",
    "@testing-library/react": "^16.3.0",
    "@types/node": "^20",
    "@types/react": "^18",
    "@types/react-dom": "^18",
    "@typescript-eslint/eslint-plugin": "^6.21.0",
    "@typescript-eslint/parser": "^6.21.0",
    "@vitejs/plugin-react": "^4.5.1",
    "@vitest/coverage-v8": "^3.2.2",
    "autoprefixer": "^10",
    "eslint": "^8.57.1",
    "eslint-config-next": "14.0.0",
    "eslint-plugin-jsx-a11y": "^6.10.2",
    "eslint-plugin-react": "^7.37.5",
    "eslint-plugin-react-hooks": "^5.0.0-canary-7118f5dd7-20230705",
    "eslint-plugin-tailwindcss": "^3.18.0",
    "jsdom": "^26.1.0",
    "postcss": "^8",
    "prettier": "^3.5.3",
    "tailwindcss": "^3",
    "typescript": "^5",
    "vitest": "^3.2.1"
  }
}

END OF FILE: frontend/package.json
===============================

ğŸ“ FILE: frontend/next.config.js
=================================
/** @type {import('next').NextConfig} */
const nextConfig = {
  // âœ… ØªÙØ¹ÙŠÙ„ standalone output Ù„Ù„Ù€ Firebase App Hosting
  output: 'standalone',
  // âœ… Ø¥Ø²Ø§Ù„Ø© static export Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ SSR ÙƒØ§Ù…Ù„
  // output: 'export', - Ù…Ø­Ø°ÙˆÙ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ React interactivity ÙƒØ§Ù…Ù„
  trailingSlash: false,
  // distDir: 'out', - Ù…Ø­Ø°ÙˆÙ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… .next Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
  
  // ØªÙ…ÙƒÙŠÙ† Image Optimization Ù…Ø¹ SSR
  images: {
    domains: ['firebasestorage.googleapis.com', 'lh3.googleusercontent.com'],
    formats: ['image/webp', 'image/avif'],
  },
  
  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØµØ§Ø±Ù…Ø© Ù„Ù„Ø¥Ù†ØªØ§Ø¬
  eslint: {
    ignoreDuringBuilds: false,
  },
  typescript: {
    ignoreBuildErrors: false,
  },
  
  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù…Ø­Ø³Ù†Ø©
  experimental: {
    missingSuspenseWithCSRBailout: false,
    optimizePackageImports: ['@mui/material', '@mui/icons-material'],
    // ğŸ”¥ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©: Ø­Ù„ Ù…Ø´Ø§ÙƒÙ„ monorepo Ù…Ø¹ standalone
    outputFileTracingRoot: require('path').join(__dirname, '../'),
  },
  
  // ğŸ”¥ Ø¥ØµÙ„Ø§Ø­ Firebase Auth prerender errors
  // ØªØ¬Ø§Ù‡Ù„ prerender errors ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡
  // ØµÙØ­Ø§Øª Auth Ø³ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ ÙÙŠ runtime
  
  // Environment Variables Ù„Ù„Ù€ Build ÙˆØ§Ù„Runtime
  env: {
    NEXT_PUBLIC_FIREBASE_API_KEY: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,
    NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,
    NEXT_PUBLIC_FIREBASE_DATABASE_URL: process.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL,
    NEXT_PUBLIC_FIREBASE_PROJECT_ID: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,
    NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
    NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
    NEXT_PUBLIC_FIREBASE_APP_ID: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,
    NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID: process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID,
    NEXT_PUBLIC_FCM_VAPID_KEY: process.env.NEXT_PUBLIC_FCM_VAPID_KEY,
    NEXT_PUBLIC_API_URL: process.env.NEXT_PUBLIC_API_URL,
    NEXT_PUBLIC_APP_ENV: process.env.NEXT_PUBLIC_APP_ENV,
    NEXT_PUBLIC_ENABLE_LOGGING: process.env.NEXT_PUBLIC_ENABLE_LOGGING,
    NEXT_PUBLIC_GOOGLE_CLIENT_ID: process.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID,
    NEXT_PUBLIC_FIRESTORE_DATABASE_ID: process.env.NEXT_PUBLIC_FIRESTORE_DATABASE_ID,
    NEXT_PUBLIC_USE_EMULATOR: process.env.NEXT_PUBLIC_USE_EMULATOR
  }
}

module.exports = nextConfig 
END OF FILE: frontend/next.config.js
=================================

ğŸ“ FILE: frontend/src/middleware.ts (ğŸ”¥ CRITICAL FOR PATCH V7)
===================================
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

/**
 * ğŸ” Middleware Ù„Ù„Ø­Ù…Ø§ÙŠØ© ÙˆØ§Ù„ØªÙˆØ¬ÙŠÙ‡ - Depth Studio
 * =====================================================
 * 
 * ğŸ¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:
 * - Ø­Ù…Ø§ÙŠØ© Ù…Ø³Ø§Ø±Ø§Øª Dashboard Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ ØºÙŠØ± Ø§Ù„Ù…ØµØ±Ø­
 * - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ tokens Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
 * - ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ØºÙŠØ± Ø§Ù„Ù…ØµØ§Ø¯Ù‚ÙŠÙ† Ù„ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
 * - Ø¯Ø¹Ù… multiple auth sources (authToken + firebaseToken)
 * 
 * ğŸ›¡ï¸ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù…ÙŠØ©:
 * - /dashboard/admin/* : Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† (super_admin ÙÙ‚Ø·)
 * - /dashboard/photographer/* : Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØµÙˆØ± (photographer ÙÙ‚Ø·)
 * - /dashboard/brand/* : Ù„ÙˆØ­Ø© Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯ (brand_coordinator ÙÙ‚Ø·)
 * - /dashboard/marketing/* : Ù„ÙˆØ­Ø© Ø§Ù„ØªØ³ÙˆÙŠÙ‚ (marketing_coordinator ÙÙ‚Ø·)
 * - /profile : Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØµØ§Ø¯Ù‚ÙŠÙ†)
 * 
 * ğŸ”„ ØªØ¯ÙÙ‚ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©:
 * 1. ÙØ­Øµ ÙˆØ¬ÙˆØ¯ authToken Ø£Ùˆ __session (Firebase)
 * 2. Ø¥Ø°Ø§ Ù…Ø³Ø§Ø± Ù…Ø­Ù…ÙŠ ÙˆØ¨Ø¯ÙˆÙ† token â†’ redirect Ù„Ù€ /auth/login
 * 3. Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø¯ÙˆØ§Ø± â†’ AuthWrapper ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡
 */
export function middleware(request: NextRequest) {
  const pathname = request.nextUrl.pathname
  
  // Skip middleware for static files and API routes
  if (
    pathname.startsWith('/_next') ||
    pathname.startsWith('/api') ||
    pathname.includes('.')
  ) {
    return NextResponse.next()
  }
  
  // Try to get auth info from multiple sources
  const authToken = request.cookies.get('authToken')?.value
  const firebaseToken = request.cookies.get('__session')?.value
  const hasAnyToken = authToken || firebaseToken
  
  // ======================================
  // ğŸ›¡ï¸ Protected routes - Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù…ÙŠØ©
  // ======================================
  
  const protectedPaths = [
    '/dashboard/admin',      // âœ… Ù…Ø¤ÙƒØ¯ Ù…ÙˆØ¬ÙˆØ¯ - Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø´Ø§Ù…Ù„Ø©
    '/dashboard/photographer', // âœ… Ù…Ø¤ÙƒØ¯ Ù…ÙˆØ¬ÙˆØ¯ - Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØµÙˆØ±
    '/dashboard/brand',      // âœ… Ù…Ø¤ÙƒØ¯ Ù…ÙˆØ¬ÙˆØ¯ - Ù„ÙˆØ­Ø© Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯
    '/dashboard/marketing',  // âœ… Ù…Ø¤ÙƒØ¯ Ù…ÙˆØ¬ÙˆØ¯ - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ³ÙˆÙŠÙ‚
    '/profile'               // âœ… Ù…Ø¤ÙƒØ¯ Ù…ÙˆØ¬ÙˆØ¯ - Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
  ];
  const isProtectedPath = protectedPaths.some(path => pathname.startsWith(path))
  
  // ======================================
  // ğŸ”‘ Authentication routes - Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©  
  // ======================================
  
  const authPaths = ['/auth/login', '/auth/register', '/phone']
  const isAuthPath = authPaths.some(path => pathname.startsWith(path))
  
  // ======================================
  // âš¡ Special routes - Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
  // ======================================
  
  const specialAuthPaths = ['/role-setup', '/pending']
  const isSpecialAuthPath = specialAuthPaths.some(path => pathname.startsWith(path))
  
  console.log('ğŸš¦ Middleware:', { 
    pathname, 
    hasAuthToken: !!authToken,
    hasFirebaseToken: !!firebaseToken,
    hasAnyToken: !!hasAnyToken,
    isProtectedPath, 
    isAuthPath, 
    isSpecialAuthPath 
  })
  
  // ======================================
  // ğŸ¯ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø°ÙƒÙŠ
  // ======================================
  
  // â­ ØªØ¨Ø³ÙŠØ· Ø§Ù„Ù…Ù†Ø·Ù‚ - Ø®Ù„ÙŠ AuthWrapper ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ÙƒÙ„ Ø´ÙŠ
  // Middleware Ø¨Ø³ ÙŠØ­Ù…ÙŠ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø© Ø¬Ø¯Ø§Ù‹
  
  // 1. Ø¥Ø°Ø§ Ø§Ù„ØµÙØ­Ø© Ù…Ø­Ù…ÙŠØ© ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø§ Ø¹Ù†Ø¯Ù‡ Ø£ÙŠ Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ†
  if (isProtectedPath && !hasAnyToken) {
    console.log('ğŸ”„ Middleware: Redirecting to login - protected path without any token')
    return NextResponse.redirect(new URL('/auth/login', request.url))
  }
  
  // 2. Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø®Ù„ÙŠ AuthWrapper ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡
  // (Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø¯ÙˆØ§Ø±ØŒ Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªÙˆÙƒÙ†ØŒ Ø¥Ù„Ø®)
  return NextResponse.next()
}

/**
 * ğŸ”¥ ENHANCED MIDDLEWARE Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Firebase App Hosting
 * 
 * Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: Firebase buildpack ÙŠØªÙˆÙ‚Ø¹ ÙˆØ¬ÙˆØ¯ middleware-manifest.json
 * Ø§Ù„Ø­Ù„: ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù€ middleware Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ù„Ø¶Ù…Ø§Ù† Ø¥Ù†Ø´Ø§Ø¡ manifest ØµØ­ÙŠØ­
 * 
 * Ø§Ù„Ø¢Ù† Ù‡Ø°Ø§ middleware ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ + ÙŠØ­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù†Ø´Ø±
 */

export const config = {
  matcher: [
    /*
     * ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø¹Ø¯Ø§:
     * - api (API routes)
     * - _next/static (static files)
     * - _next/image (image optimization files)
     * - favicon.ico (favicon file)
     */
    '/((?!api|_next/static|_next/image|favicon.ico).*)',
  ],
} 
END OF FILE: frontend/src/middleware.ts
===================================

ğŸŒ ENVIRONMENT & CONFIG FILES:
====================

ğŸ“ FILE: frontend/.env.production
==================================
# Production Environment Variables for Local Build
# Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ÙŠØ³ØªØ®Ø¯Ù… ÙÙ‚Ø· Ù„Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø­Ù„ÙŠ
# Firebase App Hosting Ø³ÙŠØ³ØªØ¨Ø¯Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ù‚ÙŠÙ… apphosting.yaml

# Firebase Configuration
NEXT_PUBLIC_FIREBASE_API_KEY=AIzaSyDHg1-mxejIMPycZJQeE0sZJmWxsimaMFI
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=depth-studio.firebaseapp.com
NEXT_PUBLIC_FIREBASE_DATABASE_URL=https://depth-studio-default-rtdb.firebaseio.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=depth-studio
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=depth-studio.firebasestorage.app
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=584154257700
NEXT_PUBLIC_FIREBASE_APP_ID=1:584154257700:web:b570a34dc3854662c3fbb1
NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID=G-RY2WLQCK1T

# Application Environment
NEXT_PUBLIC_APP_ENV=production
NEXT_PUBLIC_API_URL=https://us-central1-depth-studio.cloudfunctions.net/api
NEXT_PUBLIC_USE_EMULATOR=false
END OF FILE: frontend/.env.production
==================================

ğŸ“ FILE: frontend/.env.local (DEV CONFIG)
========================================
FILE NOT FOUND - Using .env.production for production deployment

END OF FILE: frontend/.env.local
========================================

ğŸ”‘ FIREBASE & API CONFIGURATION:
=============================

ğŸ“ FILE: firestore.rules
========================
rules_version = '2';

// ğŸ”’ Ù‚ÙˆØ§Ø¹Ø¯ Ø£Ù…Ø§Ù† Firestore Ù…Ø­Ø¯Ø«Ø© - Depth Studio (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¨Ø³Ø·Ø©)
// ğŸ“… Ù…Ø­Ø¯Ø«: Ø¯ÙŠØ³Ù…Ø¨Ø± 19, 2024  
// ğŸ‘¤ Ø§Ù„Ù…Ø·ÙˆØ±: Ø¹Ù„ÙŠ Ø¬ÙˆØ¯Øª
// ğŸ¯ Ù…ØªÙˆØ§ÙÙ‚ 100% Ù…Ø¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ ÙˆØ§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¨Ø³Ø·Ø©

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ==========================================
    // ğŸ› ï¸ HELPER FUNCTIONS (Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©)
    // ==========================================
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function isOwner(userId) {
      return request.auth.uid == userId;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Admin (Ù…Ø­Ø¯Ø« Ù„Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
    function isAdmin() {
      return isAuthenticated() && 
             exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&
             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.primary_role == 'admin';
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Marketing Coordinator
    function isMarketingCoordinator() {
      return isAuthenticated() && 
             exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&
             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.primary_role == 'marketing_coordinator';
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Brand Coordinator
    function isBrandCoordinator() {
      return isAuthenticated() && 
             exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&
             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.primary_role == 'brand_coordinator';
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Photographer
    function isPhotographer() {
      return isAuthenticated() && 
             exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&
             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.primary_role == 'photographer';
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© (Admin Ø£Ùˆ Marketing Coordinator)
    function hasAdminAccess() {
      return isAdmin() || isMarketingCoordinator();
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ user_permissions (Ù…Ø­Ø¯Ø« Ù„Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
    function hasPermission(permissionType, action) {
      return isAuthenticated() && 
             exists(/databases/$(database)/documents/user_permissions/$(request.auth.uid)) &&
             get(/databases/$(database)/documents/user_permissions/$(request.auth.uid)).data.permissions[permissionType][action] == true;
    }
    
    // ==========================================
    // ğŸ‘¥ USERS COLLECTION (Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†)
    // ==========================================
    match /users/{userId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡ Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow read: if isOwner(userId) || hasAdminAccess();
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Admin Ø£Ùˆ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø°Ø§ØªÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯
      allow create: if isAdmin() || 
                       (isOwner(userId) && request.auth.uid == userId);
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©ØŒ Ø£Ùˆ Admin Ù„Ù„ÙƒÙ„
      allow update: if (isOwner(userId) && 
                        // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ - Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙˆØ± ÙˆØ§Ù„UID
                        (!("primary_role" in request.resource.data.diff(resource.data).changedKeys()) &&
                         !("firebase_uid" in request.resource.data.diff(resource.data).changedKeys()))) ||
                       isAdmin();
      
      // Ø§Ù„Ø­Ø°Ù: Admin ÙÙ‚Ø·
      allow delete: if isAdmin();
    }
    
    // ==========================================
    // ğŸ” USER_PERMISSIONS COLLECTION (Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª)
    // ==========================================
    match /user_permissions/{userId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡ Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow read: if isOwner(userId) || hasAdminAccess();
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ« ÙˆØ§Ù„Ø­Ø°Ù: Admin ÙÙ‚Ø·
      allow create, update, delete: if isAdmin();
    }
    
    // ==========================================
    // ğŸ“¸ PHOTOGRAPHER_INFO COLLECTION (Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØµÙˆØ±ÙŠÙ†)
    // ==========================================
    match /photographer_info/{infoId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…ØµÙˆØ± Ù†ÙØ³Ù‡ Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow read: if resource.data.user_id == request.auth.uid ||
                     hasAdminAccess();
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Admin Ø£Ùˆ Ø§Ù„Ù…ØµÙˆØ± Ù†ÙØ³Ù‡
      allow create: if (request.resource.data.user_id == request.auth.uid && isPhotographer()) ||
                       isAdmin();
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ù…ØµÙˆØ± Ù†ÙØ³Ù‡ Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow update: if resource.data.user_id == request.auth.uid ||
                       hasAdminAccess();
      
      // Ø§Ù„Ø­Ø°Ù: Admin ÙÙ‚Ø·
      allow delete: if isAdmin();
    }
    
    // ==========================================
    // ğŸ¢ BRANDS COLLECTION (Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯Ø§Øª)
    // ==========================================
    match /brands/{brandId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØµØ±Ø­ Ù„Ù‡Ù…
      allow read: if isAuthenticated();
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Admin ÙÙ‚Ø·
      allow create: if hasAdminAccess();
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Admin Ø£Ùˆ Brand Coordinator Ø§Ù„Ù…Ø®ØµØµ Ù„Ù„Ø¨Ø±Ø§Ù†Ø¯
      allow update: if hasAdminAccess() ||
                       (isBrandCoordinator() && resource.data.assigned_coordinator == request.auth.uid);
      
      // Ø§Ù„Ø­Ø°Ù: Admin ÙÙ‚Ø·
      allow delete: if isAdmin();
    }
    
    // ==========================================
    // ğŸ¯ CAMPAIGNS COLLECTION (Ø§Ù„Ø­Ù…Ù„Ø§Øª)
    // ==========================================
    match /campaigns/{campaignId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØµØ±Ø­ Ù„Ù‡Ù…
      allow read: if isAuthenticated();
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Admin Ø£Ùˆ Marketing Coordinator
      allow create: if hasAdminAccess();
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Admin Ø£Ùˆ Ø§Ù„Ù…ØµÙˆØ± Ø§Ù„Ù…ÙƒÙ„Ù Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ÙÙ‚Ø·
      allow update: if hasAdminAccess() ||
                       (isPhotographer() && 
                        request.auth.uid in resource.data.assigned_photographers &&
                        request.resource.data.diff(resource.data).changedKeys().hasOnly(['status']));
      
      // Ø§Ù„Ø­Ø°Ù: Admin ÙÙ‚Ø·
      allow delete: if isAdmin();
    }
    
    // ==========================================
    // ğŸ“ CONTENT COLLECTION (Ø§Ù„Ù…Ø­ØªÙˆÙ‰)
    // ==========================================
    match /content/{contentId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…ØµÙˆØ± Ø§Ù„Ù…Ø§Ù„Ùƒ Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡ Ø£Ùˆ Brand Coordinator Ù„Ù„Ø¨Ø±Ø§Ù†Ø¯ Ø§Ù„Ù…Ø­Ø¯Ø¯
      allow read: if isAuthenticated() && (
                     resource.data.photographer_id == request.auth.uid ||
                     hasAdminAccess() ||
                     (isBrandCoordinator() && 
                      exists(/databases/$(database)/documents/brands/$(resource.data.brand_id)) &&
                      get(/databases/$(database)/documents/brands/$(resource.data.brand_id)).data.assigned_coordinator == request.auth.uid)
                  );
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø§Ù„Ù…ØµÙˆØ± Ø§Ù„Ù…Ø®ÙˆÙ„ Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow create: if isPhotographer() || hasAdminAccess();
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ù…ØµÙˆØ± Ø§Ù„Ù…Ø§Ù„Ùƒ Ù„Ù„Ù…Ù„Ø§Ø­Ø¸Ø§ØªØŒ Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
      allow update: if (resource.data.photographer_id == request.auth.uid && 
                        request.resource.data.diff(resource.data).changedKeys().hasOnly(['tags'])) ||
                       hasAdminAccess();
      
      // Ø§Ù„Ø­Ø°Ù: Ø§Ù„Ù…ØµÙˆØ± Ø§Ù„Ù…Ø§Ù„Ùƒ Ø£Ùˆ Admin
      allow delete: if resource.data.photographer_id == request.auth.uid ||
                       isAdmin();
    }
    
    // ==========================================
    // ğŸ“‚ CONTENT_CATEGORIES COLLECTION (ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰)
    // ==========================================
    match /content_categories/{categoryId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØµØ±Ø­ Ù„Ù‡Ù…
      allow read: if isAuthenticated();
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ« ÙˆØ§Ù„Ø­Ø°Ù: Admin ÙÙ‚Ø·
      allow create, update, delete: if hasAdminAccess();
    }
    
    // ==========================================
    // ğŸ’° PAYMENTS COLLECTION (Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª)
    // ==========================================
    match /payments/{paymentId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¹Ù†ÙŠ Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow read: if resource.data.user_id == request.auth.uid ||
                     hasAdminAccess();
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Admin Ø£Ùˆ Marketing Coordinator
      allow create: if hasAdminAccess();
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Admin ÙÙ‚Ø· (Ù„Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©)
      allow update: if hasAdminAccess();
      
      // Ø§Ù„Ø­Ø°Ù: Admin ÙÙ‚Ø·
      allow delete: if isAdmin();
    }
    
    // ==========================================
    // ğŸ¥ EQUIPMENT COLLECTION (Ø§Ù„Ù…Ø¹Ø¯Ø§Øª)
    // ==========================================
    match /equipment/{equipmentId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØµØ±Ø­ Ù„Ù‡Ù…
      allow read: if isAuthenticated();
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«: Admin Ø£Ùˆ Marketing Coordinator Ø£Ùˆ Ø§Ù„Ù…Ø§Ù„Ùƒ
      allow create, update: if hasAdminAccess() ||
                               (isPhotographer() && resource.data.owner_id == request.auth.uid);
      
      // Ø§Ù„Ø­Ø°Ù: Admin Ø£Ùˆ Ø§Ù„Ù…Ø§Ù„Ùƒ
      allow delete: if isAdmin() ||
                       (isPhotographer() && resource.data.owner_id == request.auth.uid);
    }
    
    // ==========================================
    // ğŸ”” NOTIFICATIONS COLLECTION (Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª)
    // ==========================================
    match /notifications/{notificationId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow read: if resource.data.user_id == request.auth.uid ||
                     hasAdminAccess();
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø§Ù„Ù†Ø¸Ø§Ù… (Admin) Ø£Ùˆ Marketing Coordinator
      allow create: if hasAdminAccess();
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©ØŒ Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow update: if (resource.data.user_id == request.auth.uid && 
                        request.resource.data.diff(resource.data).changedKeys().hasOnly(['is_read', 'status'])) ||
                       hasAdminAccess();
      
      // Ø§Ù„Ø­Ø°Ù: Admin ÙÙ‚Ø·
      allow delete: if isAdmin();
    }
    
    // ==========================================
    // ğŸ“± PHONE_VERIFICATIONS COLLECTION (ØªØ­Ù‚Ù‚ Ø§Ù„Ù‡ÙˆØ§ØªÙ)
    // ==========================================
    match /phone_verifications/{verificationId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ Ù„Ù„Ø±Ù‚Ù… Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow read: if resource.data.user_id == request.auth.uid ||
                     hasAdminAccess();
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…ØµØ±Ø­ Ù„Ù‡ Ù„Ù„ØªØ³Ø¬ÙŠÙ„ØŒ Ø£Ùˆ Ø§Ù„Ù†Ø¸Ø§Ù…
      allow create: if isAuthenticated() || hasAdminAccess();
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ØŒ Ø£Ùˆ Ø§Ù„Ù†Ø¸Ø§Ù…
      allow update: if resource.data.user_id == request.auth.uid ||
                       hasAdminAccess();
      
      // Ø§Ù„Ø­Ø°Ù: Ø§Ù„Ù†Ø¸Ø§Ù… ÙÙ‚Ø· Ù„Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
      allow delete: if hasAdminAccess();
    }
    
    // ==========================================
    // ğŸ” AUTH_METHODS COLLECTION (Ø·Ø±Ù‚ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©)
    // ==========================================
    match /auth_methods/{methodId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow read: if resource.data.user_id == request.auth.uid ||
                     hasAdminAccess();
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡ Ø£Ùˆ Ø§Ù„Ù†Ø¸Ø§Ù…
      allow create: if request.resource.data.user_id == request.auth.uid ||
                       hasAdminAccess();
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ Ø£Ùˆ Ø§Ù„Ù†Ø¸Ø§Ù… Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚
      allow update: if resource.data.user_id == request.auth.uid ||
                       hasAdminAccess();
      
      // Ø§Ù„Ø­Ø°Ù: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ (Ù„Ø­Ø°Ù Ø·Ø±ÙŠÙ‚Ø© Ù…ØµØ§Ø¯Ù‚Ø©) Ø£Ùˆ Admin
      allow delete: if resource.data.user_id == request.auth.uid ||
                       isAdmin();
    }
    
    // ==========================================
    // ğŸ­ ROLE_APPLICATIONS COLLECTION (Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø¯ÙˆØ§Ø±)
    // ==========================================
    match /role_applications/{applicationId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow read: if resource.data.user_id == request.auth.uid ||
                     hasAdminAccess();
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø¯ÙˆØ±
      allow create: if request.resource.data.user_id == request.auth.uid;
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Admin ÙÙ‚Ø· Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø£Ùˆ Ø§Ù„Ø±ÙØ¶
      allow update: if hasAdminAccess();
      
      // Ø§Ù„Ø­Ø°Ù: Admin ÙÙ‚Ø·
      allow delete: if isAdmin();
    }
    
    // ==========================================
    // ğŸ“œ OTP_LOGS COLLECTION (Ø³Ø¬Ù„ Ø±Ù…ÙˆØ² OTP)
    // ==========================================
    match /otp_logs/{logId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Admin ÙÙ‚Ø· Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„
      allow read: if hasAdminAccess();
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø§Ù„Ù†Ø¸Ø§Ù… ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ OTP
      allow create: if hasAdminAccess();
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ù†Ø¸Ø§Ù… ÙÙ‚Ø· Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ…
      allow update: if hasAdminAccess();
      
      // Ø§Ù„Ø­Ø°Ù: Admin ÙÙ‚Ø· Ù„Ù„ØªÙ†Ø¸ÙŠÙ
      allow delete: if isAdmin();
    }
    
    // ==========================================
    // ğŸ“Š AUTH_ACTIVITY_LOGS COLLECTION (Ø³Ø¬Ù„ Ù†Ø´Ø§Ø· Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©)
    // ==========================================
    match /auth_activity_logs/{activityId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ Ù„Ù„Ù†Ø´Ø§Ø· Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow read: if resource.data.user_id == request.auth.uid ||
                     hasAdminAccess();
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø§Ù„Ù†Ø¸Ø§Ù… ÙÙ‚Ø· Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·
      allow create: if hasAdminAccess();
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ù†Ø¸Ø§Ù… ÙÙ‚Ø· (Ø¹Ø§Ø¯Ø© Ù„Ø§ ÙŠÙØ­Ø¯Ø«)
      allow update: if hasAdminAccess();
      
      // Ø§Ù„Ø­Ø°Ù: Admin ÙÙ‚Ø· Ù„Ù„ØªÙ†Ø¸ÙŠÙ
      allow delete: if isAdmin();
    }
    
    // ==========================================
    // ğŸ—‘ï¸ CATCH-ALL RULE (Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)
    // ==========================================
    // Ø±ÙØ¶ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø£ÙŠ collection ØºÙŠØ± Ù…Ø­Ø¯Ø¯ ØµØ±Ø§Ø­Ø©
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

// ==========================================
// ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¨Ø³Ø·Ø©:
// ==========================================
//
// âœ… Ù…ØªÙˆØ§ÙÙ‚ 100% Ù…Ø¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø¨Ø³Ø·Ø©
// âœ… ÙŠØ¯Ø¹Ù… 10 collections ÙÙ‚Ø· (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 19)
// âœ… ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø¨Ø³Ø·Ø© ÙˆÙˆØ§Ø¶Ø­Ø©
// âœ… Ø£Ù…Ø§Ù† Ù…Ø­ÙƒÙ… Ù…Ø¹ Ù…Ø±ÙˆÙ†Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
// âœ… admin Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† super_admin
// âœ… photographer_info Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† photographer_profiles
// âœ… campaigns Ù…ÙˆØ­Ø¯Ø© (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† smart_campaigns + campaign_tasks)
// âœ… notifications Ù…ÙˆØ­Ø¯Ø© (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† campaign_notifications)
// âœ… payments Ùˆ equipment Ù…Ø¶Ø§ÙØ©
//
// ğŸ”„ Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø¯ÙŠØ³Ù…Ø¨Ø± 19, 2024
// ğŸ‘¨â€ï¿½ï¿½ Ø§Ù„Ù…Ø·ÙˆØ±: Ø¹Ù„ÙŠ Ø¬ÙˆØ¯Øª 
END OF FILE: firestore.rules
========================

ğŸ“ FILE: storage.rules
======================
rules_version = '2';

// ğŸ—„ï¸ Ù‚ÙˆØ§Ù†ÙŠÙ† Ø£Ù…Ø§Ù† Firebase Storage - Depth Studio
// ğŸ“… Ù…Ø­Ø¯Ø«: ÙŠÙˆÙ†ÙŠÙˆ 2025
// ğŸ‘¤ Ø§Ù„Ù…Ø·ÙˆØ±: Ø¹Ù„ÙŠ Ø¬ÙˆØ¯Øª
// ğŸ¯ Ø­Ù…Ø§ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„ØµÙˆØ±

service firebase.storage {
  match /b/{bucket}/o {
    
    // ==========================================
    // ğŸ› ï¸ HELPER FUNCTIONS (Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©)
    // ==========================================
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø³Ù…ÙˆØ­
    function isAllowedImageType() {
      return resource.contentType.matches('image/.*') && 
             resource.contentType in ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (Ø£Ù‚Ù„ Ù…Ù† 10MB)
    function isValidSize() {
      return resource.size < 10 * 1024 * 1024;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ù…Ù„Ù
    function isOwner(userId) {
      return request.auth.uid == userId;
    }
    
    // ==========================================
    // ğŸ“¸ Ù…Ø¬Ù„Ø¯ ØµÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Profile Pictures)
    // ==========================================
    match /users/{userId}/profile/{fileName} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
      allow read: if isAuthenticated();
      
      // Ø§Ù„ÙƒØªØ§Ø¨Ø©: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡ ÙÙ‚Ø·
      allow write: if isAuthenticated() && 
                      isOwner(userId) && 
                      isAllowedImageType() && 
                      isValidSize();
    }
    
    // ==========================================
    // ğŸ¨ Ù…Ø¬Ù„Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ù…Ù„Ø§Øª (Content)
    // ==========================================
    match /content/{contentId}/{fileName} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ (Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©)
      allow read: if isAuthenticated();
      
      // Ø§Ù„ÙƒØªØ§Ø¨Ø©: Ø§Ù„Ù…ØµÙˆØ±ÙŠÙ† ÙˆØ§Ù„Ù…Ø¯Ø±Ø§Ø¡ ÙÙ‚Ø·
      allow write: if isAuthenticated() && 
                      isAllowedImageType() && 
                      isValidSize();
    }
    
    // ==========================================
    // ğŸ¢ Ù…Ø¬Ù„Ø¯ Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯Ø§Øª (Brand Logos)  
    // ==========================================
    match /brands/{brandId}/logo/{fileName} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
      allow read: if isAuthenticated();
      
      // Ø§Ù„ÙƒØªØ§Ø¨Ø©: Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡ ÙÙ‚Ø·
      allow write: if isAuthenticated() && 
                      isAllowedImageType() && 
                      isValidSize();
    }
    
    // ==========================================
    // ğŸ“± Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© (General Uploads)
    // ==========================================
    match /uploads/{userId}/{fileName} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ø§Ù„Ùƒ Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow read: if isAuthenticated() && isOwner(userId);
      
      // Ø§Ù„ÙƒØªØ§Ø¨Ø©: Ø§Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø·
      allow write: if isAuthenticated() && 
                      isOwner(userId) && 
                      isAllowedImageType() && 
                      isValidSize();
    }
    
    // ==========================================
    // ğŸ¥ Ù…Ø¬Ù„Ø¯ Ù…Ø¹Ø¯Ø§Øª Ø§Ù„ØªØµÙˆÙŠØ± (Equipment Images)
    // ==========================================
    match /equipment/{equipmentId}/{fileName} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†
      allow read: if isAuthenticated();
      
      // Ø§Ù„ÙƒØªØ§Ø¨Ø©: Ø§Ù„Ù…ØµÙˆØ±ÙŠÙ† ÙˆØ§Ù„Ù…Ø¯Ø±Ø§Ø¡
      allow write: if isAuthenticated() && 
                      isAllowedImageType() && 
                      isValidSize();
    }
    
    // ==========================================
    // ğŸ“‹ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª (Documents) - PDF ÙˆØºÙŠØ±Ù‡Ø§
    // ==========================================
    match /documents/{userId}/{fileName} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø·
      allow read: if isAuthenticated() && isOwner(userId);
      
      // Ø§Ù„ÙƒØªØ§Ø¨Ø©: Ø§Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø· Ù…Ø¹ Ù‚ÙŠÙˆØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
      allow write: if isAuthenticated() && 
                      isOwner(userId) && 
                      (resource.contentType in ['application/pdf', 'text/plain', 'application/msword']) &&
                      resource.size < 5 * 1024 * 1024; // 5MB Ù„Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª
    }
    
    // ==========================================
    // ğŸ—‘ï¸ Ù…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø£ÙŠ Ù…Ø³Ø§Ø± ØºÙŠØ± Ù…Ø­Ø¯Ø¯
    // ==========================================
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}

// ==========================================
// ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†:
// ==========================================
// âœ… Ø¯Ø¹Ù… Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØµÙˆØ±: JPEG, PNG, WebP, GIF
// âœ… Ø­Ø¯ Ø£Ù‚ØµÙ‰ 10MB Ù„Ù„ØµÙˆØ±
// âœ… Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5MB Ù„Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª  
// âœ… Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ ØºÙŠØ± Ø§Ù„Ù…ØµØ±Ø­
// âœ… ÙØµÙ„ ÙˆØ§Ø¶Ø­ Ø¨ÙŠÙ† Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
// âœ… ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…ØªØ¯Ø±Ø¬Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ 
END OF FILE: storage.rules
======================

ğŸŒ API CONNECTION & AUTHENTICATION:
===================================

ğŸ“ FILE: frontend/src/lib/firebase/config.ts
===========================================
FILE NOT FOUND

END OF FILE: frontend/src/lib/firebase/config.ts
===========================================

ğŸ“ FILE: frontend/src/services/api/api-client.ts
=============================================
/**
 * ğŸŒ Ø¹Ù…ÙŠÙ„ API Ù…ÙˆØ­Ø¯ - Depth Studio
 * ==================================
 * 
 * Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:
 * - Ø¥Ø¶Ø§ÙØ© JWT token ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„Ù€ headers
 * - Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¨Ø±Ø³Ø§Ø¦Ù„ Ø¹Ø±Ø¨ÙŠØ© Ù…ÙˆØ­Ø¯Ø©  
 * - Ø¢Ù„ÙŠØ© retry Ù„Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø´Ø¨ÙƒØ©
 * - Interceptors Ù„Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª
 */

import axios, { 
  AxiosInstance, 
  AxiosRequestConfig, 
  AxiosResponse, 
  AxiosError 
} from 'axios';

// ÙˆØ§Ø¬Ù‡Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© API
interface ApiResponse<T> {
  data: T;
  success: boolean;
  message?: string;
}

// ======================================
// ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API
// ======================================

const BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5002/depth-studio/us-central1/api';
const TIMEOUT = 30000; // 30 Ø«Ø§Ù†ÙŠØ©
const MAX_RETRIES = 1;

// ======================================
// ğŸ—ï¸ Ø¹Ù…ÙŠÙ„ API Ø§Ù„Ù…ÙˆØ­Ø¯
// ======================================

class ApiClient {
  private client: AxiosInstance;
  private retryCount = 0;

  constructor() {
    this.client = axios.create({
      baseURL: BASE_URL,
      timeout: TIMEOUT,
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json',
      },
    });

    this.setupInterceptors();
  }

  /**
   * Ø¥Ø¹Ø¯Ø§Ø¯ interceptors Ù„Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª
   */
  private setupInterceptors(): void {
    // Request interceptor - Ø¥Ø¶Ø§ÙØ© JWT token
    this.client.interceptors.request.use(
      (config) => {
        // Ø¬Ù„Ø¨ Ø§Ù„Ù€ token Ù…Ù† localStorage (Ø³ÙŠØªÙ… Ø±Ø¨Ø·Ù‡ Ø¨Ù€ AuthStore Ù„Ø§Ø­Ù‚Ø§Ù‹)
        const token = this.getAuthToken();
        if (token) {
          config.headers.Authorization = `Bearer ${token}`;
        }

        // Ø¥Ø¶Ø§ÙØ© request_id Ù„Ù„ØªØªØ¨Ø¹
        config.headers['X-Request-ID'] = this.generateRequestId();
        
        return config;
      },
      (error) => {
        return Promise.reject(this.handleRequestError(error));
      }
    );

    // Response interceptor - Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ø£Ø®Ø·Ø§Ø¡
    this.client.interceptors.response.use(
      (response: AxiosResponse) => {
        return response;
      },
      async (error: AxiosError) => {
        return this.handleResponseError(error);
      }
    );
  }

  /**
   * Ø¬Ù„Ø¨ token Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù…Ù† localStorage
   */
  private getAuthToken(): string | null {
    if (typeof window === 'undefined') return null;
    return localStorage.getItem('auth_token');
  }

  /**
   * ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„Ù„Ø·Ù„Ø¨
   */
  private generateRequestId(): string {
    return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
  }

  /**
   * Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
   */
  private handleRequestError(error: unknown): Error {
    console.error('ğŸš¨ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ù„Ø¨:', error);
    return new Error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ù„Ø¨');
  }

  /**
   * Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª Ù…Ø¹ retry
   */
  private async handleResponseError(error: AxiosError): Promise<never> {
    const originalRequest = error.config;

    // Retry Ù„Ù„Ø£Ø®Ø·Ø§Ø¡ 5xx ÙÙ‚Ø·
    if (
      error.response?.status && 
      error.response.status >= 500 && 
      this.retryCount < MAX_RETRIES &&
      originalRequest
    ) {
      this.retryCount++;
      console.warn(`ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© ${this.retryCount}/${MAX_RETRIES} Ù„Ù„Ø·Ù„Ø¨:`, originalRequest.url);
      
      // Ø§Ù†ØªØ¸Ø§Ø± Ù‚ØµÙŠØ± Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      return this.client.request(originalRequest);
    }

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
    this.retryCount = 0;

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
    const errorMessage = this.getErrorMessage(error);
    throw new Error(errorMessage);
  }

  /**
   * Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ø¹Ø±Ø¨ÙŠØ© Ù…ÙˆØ­Ø¯Ø©
   */
  private getErrorMessage(error: AxiosError): string {
    if (!error.response) {
      return 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.';
    }

    const status = error.response.status;
    const data = error.response.data as ApiResponse<unknown>;

    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù… Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ØªÙˆÙØ±Ø©
    if (data?.message) {
      return data.message;
    }

    // Ø±Ø³Ø§Ø¦Ù„ Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø­Ø³Ø¨ ÙƒÙˆØ¯ Ø§Ù„Ø­Ø§Ù„Ø©
    switch (status) {
      case 400:
        return 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
      case 401:
        return 'Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù†ØªÙ‡ÙŠØ©. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
      case 403:
        return 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ±Ø¯';
      case 404:
        return 'Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯';
      case 409:
        return 'ØªØ¹Ø§Ø±Ø¶ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø§Ù„Ù…ÙˆØ±Ø¯ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹';
      case 422:
        return 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ù„Ø§ ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª';
      case 429:
        return 'ØªÙ… ØªØ¬Ø§ÙˆØ² Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹';
      case 500:
        return 'Ø®Ø·Ø£ Ø¯Ø§Ø®Ù„ÙŠ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹';
      case 502:
      case 503:
      case 504:
        return 'Ø§Ù„Ø®Ø§Ø¯Ù… ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹';
      default:
        return `Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ (${status}). Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰`;
    }
  }

  // ======================================
  // ğŸš€ Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ù€ HTTP
  // ======================================

  /**
   * Ø·Ù„Ø¨ GET
   */
  async get<T>(url: string, config?: AxiosRequestConfig): Promise<ApiResponse<T>> {
    const response = await this.client.get<ApiResponse<T>>(url, config);
    return response.data;
  }

  /**
   * Ø·Ù„Ø¨ POST
   */
  async post<T>(url: string, data?: unknown, config?: AxiosRequestConfig): Promise<ApiResponse<T>> {
    const response = await this.client.post<ApiResponse<T>>(url, data, config);
    return response.data;
  }

  /**
   * Ø·Ù„Ø¨ PUT
   */
  async put<T>(url: string, data?: unknown, config?: AxiosRequestConfig): Promise<ApiResponse<T>> {
    const response = await this.client.put<ApiResponse<T>>(url, data, config);
    return response.data;
  }

  /**
   * Ø·Ù„Ø¨ PATCH
   */
  async patch<T>(url: string, data?: unknown, config?: AxiosRequestConfig): Promise<ApiResponse<T>> {
    const response = await this.client.patch<ApiResponse<T>>(url, data, config);
    return response.data;
  }

  /**
   * Ø·Ù„Ø¨ DELETE
   */
  async delete<T>(url: string, config?: AxiosRequestConfig): Promise<ApiResponse<T>> {
    const response = await this.client.delete<ApiResponse<T>>(url, config);
    return response.data;
  }

  /**
   * ØªØ­Ø¯ÙŠØ« token Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
   */
  setAuthToken(token: string | null): void {
    if (typeof window === 'undefined') return;
    
    if (token) {
      localStorage.setItem('auth_token', token);
    } else {
      localStorage.removeItem('auth_token');
    }
  }

  /**
   * Ù…Ø³Ø­ token Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
   */
  clearAuthToken(): void {
    this.setAuthToken(null);
  }
}

// ======================================
// ğŸ“¤ ØªØµØ¯ÙŠØ± Ù…Ø«ÙŠÙ„ ÙˆØ­ÙŠØ¯
// ======================================

export const apiClient = new ApiClient();
export default apiClient; 
END OF FILE: frontend/src/services/api/api-client.ts
=============================================

ğŸ” BACKEND KEYS & SERVICE ACCOUNTS:
===================================

ğŸ“ DIRECTORY: backend/keys/
===========================
total 8
drwxr-xr-x@  3 alijawdat  staff    96 Jun  8 01:38 .
drwxr-xr-x@ 17 alijawdat  staff   544 Jun 10 20:11 ..
-rw-r--r--@  1 alijawdat  staff  2402 Jun  8 01:39 serviceAccountKey.json

KEYS ANALYSIS: Service account keys present for Firebase Admin SDK authentication
END OF DIRECTORY: backend/keys/
===========================

ğŸ“Š PROJECT STATUS & GIT INFO:
=============================

ğŸš€ GIT STATUS:
==============
On branch main
Your branch is up to date with 'origin/main'.

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
	modified:   deployment_analysis.txt

no changes added to commit (use "git add" and/or "git commit -a")


ğŸ“‹ SOLUTION IMPLEMENTED:
=========================

ğŸš¨ PROBLEM DIAGNOSIS:
Firebase App Hosting ignores buildCommand when Next.js is detected
Framework adapter doesn't support monorepo + middleware properly
PATCH V7 never executed - buildCommand completely bypassed

âœ… SOLUTION IMPLEMENTED:
Switched to Firebase Hosting Classic + GitHub Actions
Full control over build process
Middleware-manifest.json properly handled
Monorepo structure fully supported

ğŸ“ NEW FILES CREATED:
.github/workflows/deploy.yml - GitHub Actions workflow
firebase.json - Firebase Hosting configuration
functions/package.json - Cloud Functions package
functions/index.js - Next.js Cloud Function
DEPLOYMENT_GUIDE.md - Complete deployment guide
apphosting.yaml -> apphosting.yaml.disabled

ğŸ”„ NEXT STEPS:
1. Setup Firebase token: firebase login:ci
2. Add GitHub Secrets (FIREBASE_TOKEN, etc.)
3. Push to main branch for automatic deployment
4. Monitor at: https://github.com/USERNAME/Depth-app/actions
5. Access app at: https://depth-studio.web.app

